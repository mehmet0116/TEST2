name: DeepSeek ULTIMATE PRO v1.0
on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created, edited]
  workflow_dispatch:
    inputs:
      task:
        description: 'What should I do?'
        required: true
        default: 'Analyze and fix the project'

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  ultimate_pro_agent:
    runs-on: ubuntu-latest-16core
    timeout-minutes: 45
    if: github.actor != 'github-actions[bot]'
    
    steps:
      - name: ğŸš€ PROJE CHECKOUT (AkÄ±llÄ± Versiyon)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.head_ref || github.ref }}

      - name: ğŸ” AKILLI PROJE ANALÄ°ZÃ–RÃœ v2
        id: project_analyzer
        run: |
          echo "ğŸ¤– PROFESYONEL PROJE ANALÄ°ZÄ° BAÅLATILIYOR..."
          
          # TÃ¼m kritik dosyalarÄ± kontrol et
          PROJECT_MAP=""
          
          # Android Kontrolleri
          if [ -f "build.gradle" ] || [ -f "build.gradle.kts" ]; then
            echo "ANDROID_PROJECT=true" >> $GITHUB_ENV
            echo "ANDROID_DETECTED=âœ… Android Projesi Tespit Edildi" >> $GITHUB_ENV
            
            # Gradle wrapper kontrolÃ¼
            if [ -f "gradlew" ]; then
              GRADLE_VERSION=$(./gradlew --version 2>/dev/null | grep "Gradle" | head -1 || echo "Gradle ?")
              echo "GRADLE_VERSION=$GRADLE_VERSION" >> $GITHUB_ENV
              echo "GRADLEWRAPPER_EXISTS=true" >> $GITHUB_ENV
            else
              echo "GRADLEWRAPPER_EXISTS=false" >> $GITHUB_ENV
            fi
            
            # build.gradle iÃ§eriÄŸini analiz et
            if [ -f "build.gradle" ]; then
              echo "BUILD_GRADLE_CONTENT<<EOF" >> $GITHUB_ENV
              cat build.gradle | head -100 >> $GITHUB_ENV
              echo "EOF" >> $GITHUB_ENV
            fi
          fi
          
          # Node.js Kontrolleri
          if [ -f "package.json" ]; then
            echo "NODE_PROJECT=true" >> $GITHUB_ENV
            echo "NODE_VERSION=$(node --version 2>/dev/null || echo 'Node bulunamadÄ±')" >> $GITHUB_ENV
            echo "NPM_VERSION=$(npm --version 2>/dev/null || echo 'npm bulunamadÄ±')" >> $GITHUB_ENV
          fi
          
          # Python Kontrolleri
          if [ -f "requirements.txt" ] || [ -f "pyproject.toml" ]; then
            echo "PYTHON_PROJECT=true" >> $GITHUB_ENV
            echo "PYTHON_VERSION=$(python3 --version 2>/dev/null || echo 'Python bulunamadÄ±')" >> $GITHUB_ENV
          fi
          
          # Dosya istatistikleri
          echo "TOTAL_FILES=$(find . -type f | wc -l)" >> $GITHUB_ENV
          echo "TOTAL_DIRS=$(find . -type d | wc -l)" >> $GITHUB_ENV
          
          # Ã–nemli dosyalarÄ± listele
          find . -type f \( -name "*.gradle" -o -name "*.kt" -o -name "*.java" -o -name "*.xml" \
            -o -name "*.json" -o -name "*.js" -o -name "*.ts" -o -name "*.py" \
            -o -name "*.md" -o -name "*.yml" -o -name "*.yaml" \) \
            | head -30 > important_files.txt
          
          echo "âœ… PROFESYONEL ANALÄ°Z TAMAMLANDI"
          echo "PROJECT_TYPE=$(if [ "$ANDROID_PROJECT" = "true" ]; then echo 'Android'; elif [ "$NODE_PROJECT" = "true" ]; then echo 'Node.js'; elif [ "$PYTHON_PROJECT" = "true" ]; then echo 'Python'; else echo 'DiÄŸer'; fi)" >> $GITHUB_ENV

      - name: âš™ï¸ ZEKÄ° SÄ°STEM KURULUMU
        id: smart_setup
        run: |
          echo "ğŸ› ï¸ AKILLI SÄ°STEM KURULUMU BAÅLATILIYOR..."
          
          # Temel paketleri kur
          sudo apt-get update -y
          sudo apt-get install -y curl wget git unzip build-essential jq
          
          # ANDROID Ä°Ã‡Ä°N KURULUMLAR
          if [ "${{ env.ANDROID_PROJECT }}" = "true" ]; then
            echo "ğŸ“± ANDROID GELÄ°ÅTÄ°RME ORTAMI KURULUYOR..."
            
            # Java 17 Kurulumu
            if ! command -v java &> /dev/null; then
              echo "â˜• JAVA 17 KURULUYOR..."
              sudo apt-get install -y openjdk-17-jdk
              export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
              export PATH=$JAVA_HOME/bin:$PATH
              echo "JAVA_HOME=$JAVA_HOME" >> $GITHUB_ENV
            else
              echo "âœ… Java zaten kurulu: $(java -version 2>&1 | head -1)"
            fi
            
            # Gradle Wrapper yoksa OLUÅTUR
            if [ "${{ env.GRADLEWRAPPER_EXISTS }}" = "false" ]; then
              echo "ğŸ“¦ GERÃ‡EK GRADLE WRAPPER OLUÅTURULUYOR..."
              
              # Ã–nce Gradle'Ä± kur (sadece wrapper oluÅŸturmak iÃ§in)
              sudo apt-get install -y gradle
              
              # Gradle wrapper oluÅŸtur
              if [ -f "build.gradle" ] || [ -f "build.gradle.kts" ]; then
                gradle wrapper --gradle-version=8.5 --distribution-type=bin
                chmod +x gradlew
                echo "âœ… GerÃ§ek Gradle Wrapper oluÅŸturuldu!"
              else
                # build.gradle yoksa basit bir tane oluÅŸtur
                echo "plugins { id 'java' }" > build.gradle
                gradle wrapper --gradle-version=8.5 --distribution-type=bin
                chmod +x gradlew
                echo "âš ï¸ build.gradle oluÅŸturuldu ve wrapper eklendi"
              fi
            fi
            
            # Android SDK (temel araÃ§lar)
            echo "ğŸ“² Android SDK araÃ§larÄ± kontrol ediliyor..."
            sudo apt-get install -y android-sdk-platform-tools-common
            
          fi
          
          # NODE.JS Ä°Ã‡Ä°N KURULUM
          if [ "${{ env.NODE_PROJECT }}" = "true" ]; then
            echo "ğŸŸ¢ NODE.JS ORTAMI KURULUYOR..."
            curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
            sudo apt-get install -y nodejs
          fi
          
          # PYTHON Ä°Ã‡Ä°N KURULUM
          if [ "${{ env.PYTHON_PROJECT }}" = "true" ]; then
            echo "ğŸ PYTHON ORTAMI KURULUYOR..."
            sudo apt-get install -y python3 python3-pip python3-venv
          fi
          
          echo "âœ… AKILLI KURULUM TAMAMLANDI"

      - name: ğŸ§  DEEPSEEK ULTIMATE PRO ENGINE
        id: deepseek_pro_engine
        uses: actions/github-script@v7
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          PROJECT_TYPE: ${{ env.PROJECT_TYPE }}
          GRADLE_VERSION: ${{ env.GRADLE_VERSION }}
        with:
          script: |
            console.log("ğŸ§ ğŸ§ ğŸ§  DEEPSEEK ULTIMATE PRO ENGINE AKTÄ°F ğŸ§ ğŸ§ ğŸ§ ");
            
            const fs = require('fs');
            const path = require('path');
            
            // 1. KULLANICI MESAJINI AL
            const userMessage = context.payload.comment ? 
              context.payload.comment.body : 
              (context.payload.issue ? context.payload.issue.body : "Bu projeyi analiz et ve geliÅŸtir.");
            
            console.log(`ğŸ¯ KULLANICI Ä°STEÄÄ°:\n"${userMessage}"\n`);
            
            // 2. API KEY KONTROLÃœ
            const apiKey = process.env.DEEPSEEK_API_KEY?.trim();
            if (!apiKey) {
              throw new Error("âŒâŒâŒ KRÄ°TÄ°K HATA: DEEPSEEK_API_KEY GitHub Secrets'ta bulunamadÄ±!\nLÃ¼tfen: Settings > Secrets and variables > Actions > New repository secret");
            }
            
            // 3. PROJE DOSYALARINI OKU (AKILLI OKUMA)
            console.log("ğŸ“– PROJE DOSYALARI OKUNUYOR...");
            let projectContext = "ğŸš€ PROJE DURUM RAPORU ğŸš€\n\n";
            
            // Ã–NEMLÄ° DOSYA LÄ°STESÄ°
            const essentialFiles = {
              android: [
                'build.gradle', 'build.gradle.kts', 'settings.gradle', 'settings.gradle.kts',
                'app/build.gradle', 'app/build.gradle.kts', 
                'gradle/wrapper/gradle-wrapper.properties',
                'app/src/main/AndroidManifest.xml',
                'app/src/main/res/values/strings.xml'
              ],
              nodejs: ['package.json', 'package-lock.json', 'index.js', 'app.js', 'src/index.js'],
              python: ['requirements.txt', 'pyproject.toml', 'setup.py', 'main.py', 'app.py']
            };
            
            // Hangi proje tipi?
            const projType = process.env.PROJECT_TYPE?.toLowerCase() || 'android';
            const filesToRead = essentialFiles[projType] || essentialFiles.android;
            
            let totalRead = 0;
            for (const file of filesToRead) {
              try {
                const { data } = await github.rest.repos.getContent({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  path: file,
                  ref: context.ref || 'main'
                });
                
                if (data.type === 'file') {
                  const content = Buffer.from(data.content, 'base64').toString('utf8');
                  const safeContent = content.length > 2500 ? 
                    content.substring(0, 1200) + `\n\n... [DOSYA Ã‡OK UZUN, ${content.length} karakter] ...\n\n` + 
                    content.substring(content.length - 1200) : 
                    content;
                  
                  projectContext += `ğŸ“„ ${file} (${content.length} karakter):\n\`\`\`\n${safeContent}\n\`\`\`\n\n`;
                  totalRead++;
                }
              } catch (err) {
                projectContext += `ğŸ“„ ${file}: âŒ DOSYA BULUNAMADI\n\n`;
              }
            }
            
            console.log(`âœ… ${totalRead} adet Ã¶nemli dosya okundu.`);
            
            // 4. PROFESYONEL SYSTEM PROMPT (Ã‡OK DETAYLI)
            const systemPrompt = `
            SEN "DEEPSEEK ULTIMATE PRO" ADINDA BÄ°R YAPAY ZEKA AJANISIN.
            KullanÄ±cÄ±nÄ±n istediÄŸi HER ÅEYÄ°, EKSÄ°KSÄ°Z, HATASIZ ve PROFESYONEL ÅŸekilde yaparsÄ±n.
            
            ğŸ”¥ KRÄ°TÄ°K GÃ–REVLERÄ°N:
            1. TAM KOD ÃœRET: Eksiksiz, derlenebilir, Ã§alÄ±ÅŸabilir kodlar Ã¼ret.
            2. HATA Ã‡Ã–Z: Mevcut hatalarÄ± tespit et ve KESÄ°N Ã‡Ã–ZÃœM Ã¼ret.
            3. DOSYA YÃ–NET: Eksik dosyalarÄ± oluÅŸtur, hatalÄ±larÄ± dÃ¼zelt.
            4. YAPILANDIRMA: Gradle, package.json, requirements.txt gibi yapÄ±landÄ±rma dosyalarÄ±nÄ± DOÄRU ayarla.
            5. SÃœRÃœM UYUMLULUÄU: Gradle, Kotlin, Java, Node.js sÃ¼rÃ¼mlerini UYUMLU yap.
            
            âš¡ Ã‡IKTI FORMATI (DEÄÄ°ÅMEZ KURAL):
            Her dosya iÃ§in AYNI formatta Ã§Ä±ktÄ± ver:
            
            ---START_FILE: dosya/yolu/adi.uzanti---
            [DOSYANIN TAM Ä°Ã‡ERÄ°ÄÄ° BURAYA]
            ---END_FILE---
            
            Ã–RNEK:
            ---START_FILE: app/build.gradle---
            plugins {
                id 'com.android.application'
                id 'org.jetbrains.kotlin.android'
            }
            android {
                compileSdk 34
                namespace 'com.example.app'
                defaultConfig {
                    applicationId "com.example.app"
                    minSdk 24
                    targetSdk 34
                    versionCode 1
                    versionName "1.0"
                }
            }
            dependencies {
                implementation 'androidx.core:core-ktx:1.12.0'
                implementation 'androidx.appcompat:appcompat:1.6.1'
            }
            ---END_FILE---
            
            ğŸš¨ YAPMAYACAÄIN ÅEYLER:
            - ASLA "burayÄ± sen tamamla" DEME
            - ASLA yarÄ±m bÄ±rakma
            - ASLA aÃ§Ä±klama yapmadan kod verme
            - TÃœM baÄŸÄ±mlÄ±lÄ±klarÄ± ekle
            - SÃ¼rÃ¼m uyumsuzluÄŸu BIRAKMA
            
            ğŸ“± ANDROID Ä°Ã‡Ä°N EK KURALLAR:
            - Gradle 8.5+ kullan
            - Kotlin 1.9.0+ kullan
            - Java 17 uyumlu ol
            - View Binding/Data Binding doÄŸru ayarla
            - Minimum SDK 24, Target SDK 34 kullan
            
            ğŸ¯ HATA ALIRSAK:
            EÄŸer derleme hatasÄ± varsa, HATANIN TAM MESAJINI al ve O HATAYI Ã‡Ã–ZEN kodu Ã¼ret.
            
            ÅÄ°MDÄ° BAÅLA ve KULLANICI Ä°STEÄÄ°NÄ° TAMAMLA:
            `.trim();
            
            // 5. API Ä°STEÄÄ° (PROFESYONEL)
            console.log("ğŸ“¡ DEEPSEEK API'YE PROFESYONEL Ä°STEK GÃ–NDERÄ°LÄ°YOR...");
            
            const requestBody = {
              model: "deepseek-chat",
              messages: [
                { 
                  role: "system", 
                  content: systemPrompt 
                },
                { 
                  role: "user", 
                  content: `ğŸ¯ KULLANICI TALÄ°MATI: "${userMessage}"
                  
                  ğŸ“Š PROJE BÄ°LGÄ°LERÄ°:
                  - Proje Tipi: ${process.env.PROJECT_TYPE}
                  - Gradle Versiyonu: ${process.env.GRADLE_VERSION || 'Bilinmiyor'}
                  - Toplam Dosya: ${process.env.TOTAL_FILES || '0'}
                  
                  ğŸ“ MEVCUT PROJE DURUMU:
                  ${projectContext}
                  
                  âš¡ TALÄ°MAT: 
                  YukarÄ±daki sistemi prompt'unu DÄ°KKATLE OKU.
                  KullanÄ±cÄ±nÄ±n istediÄŸini TAM ve EKSÄ°KSÄ°Z yap.
                  Gerekli TÃœM dosyalarÄ± oluÅŸtur veya dÃ¼zelt.
                  Hata varsa Ã‡Ã–Z.
                  SÃ¼rÃ¼m uyumsuzluÄŸu varsa DÃœZELT.
                  
                  HAZIR MISIN? BAÅLA! ğŸš€` 
                }
              ],
              max_tokens: 32000,
              temperature: 0.1,
              stream: false
            };
            
            console.log(`ğŸ“Š API Ä°steÄŸi hazÄ±r: ${JSON.stringify(requestBody).length} karakter`);
            
            try {
              const response = await fetch("https://api.deepseek.com/chat/completions", {
                method: "POST",
                headers: {
                  "Authorization": `Bearer ${apiKey}`,
                  "Content-Type": "application/json",
                  "Accept": "application/json"
                },
                body: JSON.stringify(requestBody)
              });
              
              if (!response.ok) {
                const errorDetail = await response.text();
                console.error(`âŒ API HATASI ${response.status}:`, errorDetail.substring(0, 500));
                throw new Error(`DeepSeek API hatasÄ± ${response.status}`);
              }
              
              const data = await response.json();
              const aiRawResponse = data.choices[0]?.message?.content || "";
              
              if (!aiRawResponse || aiRawResponse.trim().length < 10) {
                throw new Error("AI'dan geÃ§ersiz veya boÅŸ yanÄ±t alÄ±ndÄ±.");
              }
              
              console.log(`âœ… AI YANITI ALINDI: ${aiRawResponse.length} karakter`);
              
              // 6. DOSYA Ä°ÅLEMLERÄ° (GELÄ°ÅMÄ°Å ve SAÄLAM)
              console.log("ğŸ”„ DOSYA Ä°ÅLEMLERÄ° BAÅLATILIYOR...");
              
              // GELÄ°ÅMÄ°Å REGEX PATTERN
              const filePattern = /---START_FILE:\s*(.+?)\s*---\n([\s\S]*?)\n---END_FILE---/g;
              let match;
              const processedFiles = [];
              const failedFiles = [];
              
              // TÃ¼m eÅŸleÅŸmeleri bul
              const allMatches = [];
              while ((match = filePattern.exec(aiRawResponse)) !== null) {
                allMatches.push({
                  filename: match[1].trim(),
                  content: match[2].trim()
                });
              }
              
              console.log(`ğŸ” ${allMatches.length} adet dosya bulundu.`);
              
              // Her dosyayÄ± iÅŸle
              for (const file of allMatches) {
                const fileName = file.filename;
                let fileContent = file.content;
                
                // Kod bloklarÄ±ndan temizle (```)
                if (fileContent.startsWith('```')) {
                  const firstNewLine = fileContent.indexOf('\n');
                  if (firstNewLine !== -1) {
                    fileContent = fileContent.substring(firstNewLine + 1);
                  }
                }
                if (fileContent.endsWith('```')) {
                  fileContent = fileContent.substring(0, fileContent.length - 3);
                }
                
                fileContent = fileContent.trim();
                
                console.log(`ğŸ“ Ä°ÅŸleniyor: ${fileName} (${fileContent.length} karakter)`);
                
                try {
                  // Mevcut dosyayÄ± kontrol et
                  let sha = undefined;
                  try {
                    const { data: existing } = await github.rest.repos.getContent({
                      owner: context.repo.owner,
                      repo: context.repo.repo,
                      path: fileName,
                      ref: context.ref || 'main'
                    });
                    sha = existing.sha;
                    console.log(`   â„¹ï¸ Mevcut dosya bulundu (SHA: ${sha?.substring(0, 8)}...), gÃ¼ncellenecek.`);
                  } catch (notFound) {
                    console.log(`   â„¹ï¸ Yeni dosya oluÅŸturulacak.`);
                  }
                  
                  // DosyayÄ± oluÅŸtur/gÃ¼ncelle
                  await github.rest.repos.createOrUpdateFileContents({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    path: fileName,
                    message: `ğŸ¤– DEEPSEEK PRO: ${userMessage.substring(0, 60)}${userMessage.length > 60 ? '...' : ''}`,
                    content: Buffer.from(fileContent).toString('base64'),
                    sha: sha,
                    branch: context.ref ? undefined : 'main'
                  });
                  
                  processedFiles.push(fileName);
                  console.log(`   âœ… ${sha ? 'GÃœNCELLENDÄ°' : 'OLUÅTURULDU'}: ${fileName}`);
                  
                } catch (fileError) {
                  console.error(`   âŒ ${fileName} iÅŸlenemedi:`, fileError.message);
                  failedFiles.push(`${fileName}: ${fileError.message}`);
                }
              }
              
              console.log(`ğŸ‰ DOSYA Ä°ÅLEMLERÄ° TAMAMLANDI: ${processedFiles.length} baÅŸarÄ±lÄ±, ${failedFiles.length} baÅŸarÄ±sÄ±z`);
              
              // 7. SONUÃ‡LARI HAZIRLA
              const resultSummary = {
                success: processedFiles.length,
                failed: failedFiles.length,
                totalFiles: allMatches.length,
                aiResponsePreview: aiRawResponse.substring(0, 2000) + (aiRawResponse.length > 2000 ? "..." : ""),
                processedFiles: processedFiles,
                failedFiles: failedFiles,
                userRequest: userMessage.substring(0, 200)
              };
              
              // Ã‡Ä±ktÄ±larÄ± ayarla (sonraki adÄ±mlar iÃ§in)
              const core = require('@actions/core');
              core.setOutput('ai_response', resultSummary.aiResponsePreview);
              core.setOutput('files_processed', processedFiles.length.toString());
              core.setOutput('files_failed', failedFiles.length.toString());
              core.setOutput('file_list', processedFiles.join('|'));
              core.setOutput('failed_list', failedFiles.join('|'));
              core.setOutput('user_request', resultSummary.userRequest);
              
              return resultSummary;
              
            } catch (apiError) {
              console.error("âŒâŒâŒ DEEPSEEK ENGINE'DE KRÄ°TÄ°K HATA:", apiError);
              throw apiError;
            }

      - name: ğŸ—ï¸ PROFESYONEL BUILD ve TEST
        id: pro_build_test
        run: |
          echo "ğŸ”§ PROFESYONEL BUILD ve TEST SÄ°STEMÄ° BAÅLATILIYOR..."
          
          BUILD_LOG="build_output_$(date +%s).log"
          TEST_LOG="test_output_$(date +%s).log"
          
          {
            echo "=== PROFESYONEL BUILD RAPORU ==="
            echo "BaÅŸlangÄ±Ã§: $(date)"
            echo "Proje Tipi: ${{ env.PROJECT_TYPE }}"
            echo "================================="
            echo ""
            
            # ANDROID BUILD
            if [ "${{ env.ANDROID_PROJECT }}" = "true" ]; then
              echo "ğŸ“± ANDROID PROFESYONEL BUILD BAÅLATILIYOR..."
              echo "Gradle Wrapper Durumu: ${{ env.GRADLEWRAPPER_EXISTS }}"
              echo ""
              
              # 1. Gradle wrapper kontrolÃ¼ ve hazÄ±rlÄ±k
              if [ -f "gradlew" ]; then
                chmod +x gradlew
                echo "âœ… Gradle Wrapper hazÄ±r."
                
                # 2. Temizleme
                echo "ğŸ§¹ Gradle clean Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
                ./gradlew clean --no-daemon --stacktrace 2>&1 | tee -a clean.log
                
                # 3. Derleme (debug)
                echo "ğŸ”¨ Gradle build (debug) Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
                if ./gradlew assembleDebug --no-daemon --stacktrace 2>&1 | tee -a $BUILD_LOG; then
                  echo "ğŸ‰ ANDROID BUILD BAÅARILI!"
                  echo "BUILD_STATUS=success" >> $GITHUB_ENV
                  
                  # APK kontrolÃ¼
                  if find . -name "*.apk" -type f | grep -q .; then
                    APK_FILES=$(find . -name "*.apk" -type f | wc -l)
                    echo "ğŸ“¦ $APK_FILES adet APK oluÅŸturuldu."
                    echo "APK_COUNT=$APK_FILES" >> $GITHUB_ENV
                  fi
                else
                  echo "âŒ ANDROID BUILD BAÅARISIZ!"
                  echo "BUILD_STATUS=failed" >> $GITHUB_ENV
                  
                  # Hata analizi
                  echo "ğŸ” HATA ANALÄ°ZÄ°:"
                  tail -100 $BUILD_LOG | grep -A 5 -B 5 -i "error\|failed\|exception" | head -50
                fi
                
                # 4. Test Ã§alÄ±ÅŸtÄ±r (varsa)
                echo "ğŸ§ª Testler Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
                ./gradlew test --no-daemon 2>&1 | tail -100 | tee -a $TEST_LOG || echo "Testler Ã§alÄ±ÅŸtÄ±rÄ±lamadÄ±"
                
              else
                echo "âš ï¸ Gradle Wrapper bulunamadÄ±, build atlanÄ±yor."
                echo "BUILD_STATUS=skipped" >> $GITHUB_ENV
              fi
              
            # NODE.JS BUILD
            elif [ "${{ env.NODE_PROJECT }}" = "true" ]; then
              echo "ğŸŸ¢ NODE.JS BUILD BAÅLATILIYOR..."
              
              if [ -f "package.json" ]; then
                npm install --silent 2>&1 | tail -50
                
                if grep -q '"build"' package.json; then
                  npm run build 2>&1 | tail -100 | tee -a $BUILD_LOG
                  echo "BUILD_STATUS=success" >> $GITHUB_ENV
                else
                  echo "â„¹ï¸ Build script bulunamadÄ±, temel kontrol yapÄ±lÄ±yor."
                  node --check index.js 2>/dev/null || node --check app.js 2>/dev/null || echo "Temel kontrol atlandÄ±"
                  echo "BUILD_STATUS=skipped" >> $GITHUB_ENV
                fi
              fi
              
            # PYTHON BUILD
            elif [ "${{ env.PYTHON_PROJECT }}" = "true" ]; then
              echo "ğŸ PYTHON BUILD BAÅLATILIYOR..."
              
              if [ -f "requirements.txt" ]; then
                pip install -r requirements.txt 2>&1 | tail -50
                echo "BUILD_STATUS=success" >> $GITHUB_ENV
              elif [ -f "pyproject.toml" ]; then
                pip install . 2>&1 | tail -50
                echo "BUILD_STATUS=success" >> $GITHUB_ENV
              else
                echo "â„¹ï¸ BaÄŸÄ±mlÄ±lÄ±k dosyasÄ± bulunamadÄ±."
                echo "BUILD_STATUS=skipped" >> $GITHUB_ENV
              fi
            fi
            
            echo ""
            echo "=== BUILD SONUÃ‡LARI ==="
            echo "BitiÅŸ: $(date)"
            echo "Durum: ${{ env.BUILD_STATUS || 'bilinmiyor' }}"
            echo "========================="
            
          } | tee full_build_report.log
          
          echo "âœ… PROFESYONEL BUILD TAMAMLANDI"

      - name: ğŸ“Š PROFESYONEL SONUÃ‡ RAPORU
        uses: actions/github-script@v7
        env:
          AI_RESPONSE: ${{ steps.deepseek_pro_engine.outputs.ai_response }}
          FILES_PROCESSED: ${{ steps.deepseek_pro_engine.outputs.files_processed }}
          FILES_FAILED: ${{ steps.deepseek_pro_engine.outputs.files_failed }}
          FILE_LIST: ${{ steps.deepseek_pro_engine.outputs.file_list }}
          USER_REQUEST: ${{ steps.deepseek_pro_engine.outputs.user_request }}
          BUILD_STATUS: ${{ env.BUILD_STATUS }}
          APK_COUNT: ${{ env.APK_COUNT }}
        with:
          script: |
            console.log("ğŸ“Š PROFESYONEL SONUÃ‡ RAPORU HAZIRLANIYOR...");
            
            const issueNumber = context.payload.issue?.number || 
                               (context.payload.comment ? context.payload.comment.issue_number : null);
            
            if (!issueNumber) {
              console.log("â„¹ï¸ Issue bulunamadÄ±, rapor oluÅŸturulmayacak.");
              return;
            }
            
            // VERÄ°LERÄ° AL
            const aiResponse = process.env.AI_RESPONSE || "AI yanÄ±tÄ± alÄ±namadÄ±.";
            const filesProcessed = parseInt(process.env.FILES_PROCESSED || '0');
            const filesFailed = parseInt(process.env.FILES_FAILED || '0');
            const fileList = (process.env.FILE_LIST || "").split('|').filter(f => f);
            const userRequest = process.env.USER_REQUEST || "Ä°stek belirtilmemiÅŸ";
            const buildStatus = process.env.BUILD_STATUS || "bilinmiyor";
            const apkCount = process.env.APK_COUNT || "0";
            
            // PROFESYONEL RAPOR OLUÅTUR
            let report = `# ğŸ¤– DEEPSEEK ULTIMATE PRO v1.0 - PROFESYONEL RAPOR\n\n`;
            
            // ğŸ“Œ Ã–ZET TABLOSU
            report += `## ğŸ“Œ Ä°ÅLEM Ã–ZETÄ°\n`;
            report += `| Kategori | DeÄŸer |\n|----------|-------|\n`;
            report += `| **KullanÄ±cÄ± Ä°steÄŸi** | ${userRequest} |\n`;
            report += `| **Ä°ÅŸlenen Dosya** | ${filesProcessed} adet |\n`;
            report += `| **BaÅŸarÄ±sÄ±z Dosya** | ${filesFailed} adet |\n`;
            report += `| **Build Durumu** | ${buildStatus === 'success' ? 'âœ… BAÅARILI' : buildStatus === 'failed' ? 'âŒ BAÅARISIZ' : 'âš ï¸ ATLANDI'} |\n`;
            if (apkCount !== "0") {
              report += `| **OluÅŸturulan APK** | ${apkCount} adet |\n`;
            }
            report += `| **Rapor ZamanÄ±** | ${new Date().toLocaleString('tr-TR')} |\n\n`;
            
            // ğŸ“ Ä°ÅLENEN DOSYALAR
            if (fileList.length > 0) {
              report += `## ğŸ“ Ä°ÅLENEN DOSYALAR\n`;
              fileList.forEach(file => {
                report += `- âœ… \`${file}\`\n`;
              });
              report += `\n`;
            }
            
            // ğŸ”§ BUILD DURUMU
            report += `## ğŸ”§ BUILD SONUÃ‡LARI\n`;
            switch(buildStatus) {
              case 'success':
                report += `### ğŸ‰ BUILD BAÅARILI!\n`;
                report += `Projeniz baÅŸarÄ±yla derlendi. `;
                if (apkCount !== "0") {
                  report += `**${apkCount} adet APK** oluÅŸturuldu. `;
                }
                report += `Projenizi Android Studio'da aÃ§abilir veya oluÅŸturulan APK'yÄ± test edebilirsiniz.\n\n`;
                break;
              case 'failed':
                report += `### âŒ BUILD BAÅARISIZ\n`;
                report += `Proje derlemesinde hata oluÅŸtu. LÃ¼tfen aÅŸaÄŸÄ±daki AI analizini inceleyin veya GitHub Actions loglarÄ±nÄ± kontrol edin.\n\n`;
                break;
              default:
                report += `### â„¹ï¸ BUILD ATLANDI\n`;
                report += `Build iÅŸlemi bu proje tipi iÃ§in otomatik olarak Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ± veya gerekli dosyalar bulunamadÄ±.\n\n`;
            }
            
            // ğŸ§  AI ANALÄ°ZÄ° ve KODLAR
            report += `## ğŸ§  DEEPSEEK PRO ANALÄ°ZÄ°\n`;
            report += `<details>\n<summary><b>ğŸ“ TÄ±klayarak AI YanÄ±tÄ±nÄ± ve KodlarÄ± GÃ¶rÃ¼ntÃ¼leyin (${aiResponse.length} karakter)</b></summary>\n\n`;
            report += `\`\`\`\n${aiResponse}\n\`\`\`\n`;
            report += `</details>\n\n`;
            
            // ğŸš€ SONRAKÄ° ADIMLAR
            report += `## ğŸš€ SONRAKÄ° ADIMLAR\n`;
            
            if (buildStatus === 'success') {
              report += `1. **ğŸ“± Android Studio'da AÃ§:** Projeyi Android Studio'da aÃ§Ä±n ve Ã§alÄ±ÅŸtÄ±rÄ±n.\n`;
              report += `2. **ğŸ“¦ APK Testi:** OluÅŸturulan APK'yÄ± telefonunuza yÃ¼kleyerek test edin.\n`;
              report += `3. **âœï¸ GeliÅŸtirmeye Devam:** Ä°htiyacÄ±nÄ±z olan ek Ã¶zellikleri ekleyin.\n`;
            } else if (buildStatus === 'failed') {
              report += `1. **ğŸ” Hata Analizi:** YukarÄ±daki AI analizini dikkatle okuyun.\n`;
              report += `2. **ğŸ“‹ Log KontrolÃ¼:** GitHub Actions sekmesinden detaylÄ± loglarÄ± inceleyin.\n`;
              report += `3. **ğŸ”„ Yeniden Dene:** Gerekli dÃ¼zeltmeleri yaparak iÅŸlemi tekrar baÅŸlatÄ±n.\n`;
            } else {
              report += `1. **ğŸ‘€ Dosya Ä°nceleme:** OluÅŸturulan dosyalarÄ± GitHub'da inceleyin.\n`;
              report += `2. **ğŸ› ï¸ Manuel Build:** Projeyi yerel makinenizde derlemeyi deneyin.\n`;
              report += `3. **ğŸ“ Feedback:** Eksik veya hatalÄ± bir ÅŸey varsa yeni bir issue aÃ§Ä±n.\n`;
            }
            
            report += `\n4. **ğŸ¤– Yeni Ä°stek:** BaÅŸka bir ÅŸeye ihtiyacÄ±nÄ±z varsa bu issue'ya yorum yapÄ±n!\n\n`;
            
            // ğŸ“ DESTEK
            report += `## ğŸ“ TEKNÄ°K DESTEK\n`;
            report += `- **GitHub Actions LoglarÄ±:** Bu iÅŸlemin tam loglarÄ±nÄ± gÃ¶rmek iÃ§in [Actions sekmesine](https://github.com/${context.repo.owner}/${context.repo.repo}/actions) gidin.\n`;
            report += `- **Dosya DeÄŸiÅŸiklikleri:** OluÅŸturulan/gÃ¼ncellenen dosyalarÄ± gÃ¶rmek iÃ§in [Commits sayfasÄ±nÄ±](https://github.com/${context.repo.owner}/${context.repo.repo}/commits) kontrol edin.\n`;
            report += `- **Yeni Issue:** BaÅŸka bir problem iÃ§in [yeni issue aÃ§Ä±n](https://github.com/${context.repo.owner}/${context.repo.repo}/issues/new).\n\n`;
            
            report += `---\n*Bu rapor **DeepSeek Ultimate Pro Agent v1.0** tarafÄ±ndan otomatik oluÅŸturulmuÅŸtur.* ğŸ¤–âœ¨\n`;
            
            // RAPORU GÃ–NDER
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: report
            });
            
            console.log(`âœ… PROFESYONEL RAPOR GÃ–NDERÄ°LDÄ°: ${report.length} karakter`);

      - name: ğŸ‰ PROSES TAMAMLANDI
        run: |
          echo ""
          echo "âœ¨âœ¨âœ¨ DEEPSEEK ULTIMATE PRO v1.0 âœ¨âœ¨âœ¨"
          echo "âœ… TÃœM Ä°ÅLEMLER BAÅARIYLA TAMAMLANDI!"
          echo ""
          echo "ğŸ“Š SONUÃ‡ Ã–ZETÄ°:"
          echo "- Proje Analizi: âœ… TamamlandÄ±"
          echo "- Sistem Kurulumu: âœ… TamamlandÄ±"
          echo "- DeepSeek AI Ä°ÅŸlemi: âœ… TamamlandÄ±"
          echo "- Dosya Ä°ÅŸlemleri: ${{ steps.deepseek_pro_engine.outputs.files_processed || 0 }} dosya"
          echo "- Build/Test: ${{ env.BUILD_STATUS || 'Bilinmiyor' }}"
          echo "- Raporlama: âœ… GitHub Issue'ya eklendi"
          echo ""
          echo "ğŸš€ ArtÄ±k projeniz hazÄ±r! GitHub'daki issue sayfasÄ±nda detaylÄ± raporu gÃ¶rÃ¼ntÃ¼leyebilirsiniz."
          echo ""
